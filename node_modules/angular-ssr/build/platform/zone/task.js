Object.defineProperty(exports, "__esModule", { value: true });
var rxjs_1 = require("rxjs");
require("zone.js");
var exception_1 = require("../../exception");
exports.scheduleTask = function (execute, description) {
    var subscription;
    return new rxjs_1.Observable(function (observer) {
        var result;
        var scheduleTask = function (task) {
            subscription = execute().subscribe(function (value) {
                result = value;
                task.invoke();
            }, function (error) {
                result = new exception_1.RuntimeException("Task failure: " + description, error);
            }, function () { return task.invoke(); });
        };
        var complete = function () {
            if (result instanceof Error) {
                observer.error(result);
            }
            else {
                observer.next(result);
                observer.complete();
            }
        };
        Zone.current.scheduleMacroTask('wrapped task', complete, null, scheduleTask, subscription.unsubscribe.bind(subscription));
    });
};
//# sourceMappingURL=task.js.map